import{D as te,r as c,s as z,c as le,x as se,q as f,a as n,b as U,d as G,h as ae,w as oe,e as t,g as v,o as i,t as u,f as g,F as x,k,v as D,m as C,y as j,n as re,j as ne,l as O,A as ie}from"./app-CDJn0Pzk.js";import{u as de,T as ue}from"./TeacherLayout-6RngpzKi.js";import{i as ce,a as ve,b as pe,F as ge}from"./index-1yH5HgvW.js";import{u as me}from"./useTeacherOffline-C7lCC2fg.js";import{_ as be}from"./_plugin-vue_export-helper-DlAUqK2U.js";const fe={class:"space-y-6"},ye={key:0,class:"bg-yellow-50 border-l-4 border-yellow-500 p-4 rounded-lg shadow-md"},xe={key:1,class:"bg-green-50 border-l-4 border-green-500 p-4 rounded-lg shadow-md animate-fade-in"},_e={class:"flex items-center"},we={class:"text-green-800 font-medium"},he={class:"grid grid-cols-1 lg:grid-cols-3 gap-6"},ke={class:"lg:col-span-2 bg-white rounded-lg shadow-md p-4 md:p-6"},Ce={class:"space-y-6"},Ee={class:"bg-white rounded-lg shadow-md p-6"},Me={class:"mb-4"},Se=["value"],De={class:"mb-4"},Te={class:"mb-6"},Ve={class:"space-y-2"},Ae={class:"text-sm text-gray-700"},Ue={class:"space-y-3 max-h-96 overflow-y-auto"},je=["onClick"],Be={class:"flex items-start justify-between"},Fe={class:"flex-1"},Le={class:"flex items-center gap-2"},$e={class:"font-semibold text-sm text-gray-900"},qe={key:0,class:"mr-1"},ze={key:0,class:"px-2 py-0.5 bg-orange-100 text-orange-800 text-xs rounded"},Ge={key:1,class:"px-2 py-0.5 bg-blue-100 text-blue-800 text-xs rounded"},Oe={class:"text-xs text-gray-600 mt-1"},We={key:0,class:"text-xs text-gray-500 mt-1"},Ne={class:"text-xs text-gray-600 mt-1 line-clamp-2"},Pe={key:0,class:"text-center py-6 text-gray-500 text-sm"},He={class:"bg-white rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto"},Ie={class:"sticky top-0 bg-white border-b border-gray-200 px-6 py-4 flex items-center justify-between"},Re={class:"text-xl font-bold text-gray-900"},Ye={class:"p-6"},Qe={key:0,class:"mb-4 p-4 bg-blue-50 border border-blue-200 rounded-lg"},Je={class:"text-xs text-blue-600 mt-1"},Ke=["disabled"],Xe={class:"grid grid-cols-2 gap-4"},Ze=["disabled"],et=["disabled"],tt=["disabled"],lt=["value"],st={class:"flex items-center gap-2"},at=["disabled"],ot=["disabled"],rt={key:0},nt=["disabled"],it=["value"],dt=["disabled"],ut={class:"flex justify-between pt-4"},ct=["disabled"],vt={class:"flex gap-2 ml-auto"},pt=["disabled"],gt=["disabled"],mt={__name:"Calendar",props:{events:{type:Array,default:()=>[]},courses:{type:Array,default:()=>[]}},setup(B){const E=B,{isOnline:T}=de(),{createEventOffline:F,cacheEvents:W,getCachedEvents:N}=me(),P=te(),y=c(!1),V=c(""),A=c(!1);z(()=>P.props.flash,s=>{s!=null&&s.success&&(V.value=s.success,y.value=!0,setTimeout(()=>{y.value=!1},5e3))},{deep:!0,immediate:!0});const _=c(!1),r=c(!1),o=c(null),d=c(!1),a=c({title:"",date:"",time:"",description:"",category:"general",is_deadline:!1,color:"#800000",target_audience:"both",course_id:null}),p=c([...E.events]),M=c("all"),S=c("");z(()=>E.events,s=>{p.value=[...s],h()},{deep:!0});const w=[{value:"general",label:"General",color:"#6B7280"},{value:"meeting",label:"Meeting",color:"#800000"},{value:"academic",label:"Academic Event",color:"#10B981"},{value:"deadline",label:"Deadline",color:"#F59E0B"},{value:"maintenance",label:"Maintenance",color:"#EF4444"},{value:"urgent",label:"Urgent Notice",color:"#DC2626"}],L=c({plugins:[ce,ve,pe],initialView:window.innerWidth<768?"timeGridDay":"dayGridMonth",headerToolbar:{left:"prev,next today",center:"title",right:(window.innerWidth<768,"dayGridMonth,timeGridWeek,timeGridDay")},editable:!0,selectable:!0,selectMirror:!0,dayMaxEvents:!0,weekends:!0,events:[],eventClick:q,dateClick:H,eventDrop:I,eventResize:R,height:"auto",contentHeight:window.innerWidth<768?400:"auto",aspectRatio:window.innerWidth<768?1:1.8}),$=le(()=>{let s=p.value;if(M.value!=="all"&&(s=s.filter(e=>e.category===M.value)),S.value){const e=S.value.toLowerCase();s=s.filter(l=>l.title.toLowerCase().includes(e)||l.description.toLowerCase().includes(e))}return s.sort((e,l)=>new Date(l.date)-new Date(e.date))}),h=()=>{L.value.events=p.value.map(s=>{const e=s.time?`${s.date}T${s.time}`:s.date,l=s.color+"20";return{id:s.id,title:s.is_deadline?"ðŸ“Œ "+s.title:s.title,start:e,allDay:!s.time,backgroundColor:l,borderColor:s.color,textColor:"#000000",extendedProps:{description:s.description,category:s.category,is_deadline:s.is_deadline,color:s.color,course_name:s.course_name,created_by:s.created_by,is_own:s.is_own}}})};se(async()=>{var s;if(T.value&&((s=E.events)==null?void 0:s.length)>0)await W(E.events),A.value=!1;else if(!T.value){const e=await N();e&&e.length>0&&(p.value=e,A.value=!0)}h()});function q(s){const e=p.value.find(l=>l.id==s.event.id);e&&(o.value=e,a.value={title:e.title,date:e.date,time:e.time||"",description:e.description,category:e.category,is_deadline:e.is_deadline||!1,color:e.color,target_audience:e.target_audience||"all_courses",course_id:e.course_id||null},r.value=!0,_.value=!0)}function H(s){a.value={title:"",date:s.dateStr,time:"",description:"",category:"general",is_deadline:!1,color:"#800000",target_audience:"all_courses",course_id:null},r.value=!1,o.value=null,_.value=!0}function I(s){const e=p.value.find(l=>l.id==s.event.id);if(e&&e.is_own){const l=s.event.startStr.split("T")[0],b=s.event.startStr.includes("T")?s.event.startStr.split("T")[1].substring(0,5):null;d.value=!0,f.patch(route("teacher.calendar.updateDateTime",e.id),{date:l,time:b},{preserveScroll:!0,onSuccess:()=>{d.value=!1},onError:()=>{s.revert(),d.value=!1,alert("Failed to update event date")}})}else s.revert(),alert("You can only edit your own events")}function R(s){const e=p.value.find(l=>l.id==s.event.id);if(e&&e.is_own){const l=s.event.startStr.split("T")[0];e.date=l,h()}else s.revert()}function Y(){a.value={title:"",date:new Date().toISOString().split("T")[0],time:"",description:"",category:"general",is_deadline:!1,color:"#800000",target_audience:"all_courses",course_id:null},r.value=!1,o.value=null,_.value=!0}async function Q(){if(!a.value.title||!a.value.date||!a.value.description){alert("Please fill in all required fields");return}if(a.value.target_audience==="specific_course"&&!a.value.course_id){alert("Please select a course");return}d.value=!0;const s=w.find(l=>l.value===a.value.category),e={title:a.value.title,date:a.value.date,time:a.value.time||null,description:a.value.description,category:a.value.category,is_deadline:a.value.is_deadline,color:s.color,target_audience:a.value.target_audience,course_id:a.value.target_audience==="students"?a.value.course_id:null};if(!T.value){if(r.value&&o.value){await F({...e,id:o.value.id,_method:"PUT"});const l=p.value.findIndex(b=>b.id===o.value.id);l!==-1&&(p.value[l]={...p.value[l],...e},h())}else{const l="temp_"+Date.now();await F({...e,id:l}),p.value.unshift({id:l,...e,is_own:!0,created_by:"You"}),h()}d.value=!1,m(),V.value=r.value?"âœ“ Event updated offline. Will sync when online.":"âœ“ Event created offline. Will sync when online.",y.value=!0,setTimeout(()=>y.value=!1,5e3);return}r.value&&o.value?f.put(route("teacher.calendar.update",o.value.id),e,{preserveScroll:!0,onSuccess:()=>{m(),d.value=!1,f.reload({only:["events"]})},onError:()=>{d.value=!1,alert("Failed to update event")}}):f.post(route("teacher.calendar.store"),e,{preserveScroll:!0,onSuccess:()=>{m(),d.value=!1,f.reload({only:["events"]})},onError:()=>{d.value=!1,alert("Failed to create event")}})}function J(s){confirm("Are you sure you want to delete this event?")&&(d.value=!0,f.delete(route("teacher.calendar.destroy",s),{preserveScroll:!0,onSuccess:()=>{m(),d.value=!1,f.reload({only:["events"]})},onError:()=>{d.value=!1,alert("Failed to delete event")}}))}function m(){_.value=!1,r.value=!1,o.value=null,a.value={title:"",date:"",time:"",description:"",category:"general",is_deadline:!1,color:"#800000",target_audience:"both",course_id:null}}function K(s){var e;return((e=w.find(l=>l.value===s))==null?void 0:e.label)||s}const X=s=>new Date(s).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"}),Z=s=>{if(!s)return"All Day";const[e,l]=s.split(":"),b=parseInt(e),ee=b>=12?"PM":"AM";return`${b%12||12}:${l} ${ee}`};return(s,e)=>(i(),n(x,null,[U(G(ae),{title:"Calendar - Events & Announcements"}),U(ue,null,{default:oe(()=>[t("div",fe,[A.value?(i(),n("div",ye,[...e[12]||(e[12]=[t("div",{class:"flex items-center"},[t("svg",{class:"w-6 h-6 text-yellow-600 mr-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})]),t("p",{class:"text-yellow-800 font-medium"},"ðŸ“Œ Viewing Cached Events (Offline Mode)")],-1)])])):v("",!0),y.value?(i(),n("div",xe,[t("div",_e,[e[14]||(e[14]=t("svg",{class:"w-6 h-6 text-green-500 mr-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})],-1)),t("p",we,u(V.value),1),t("button",{onClick:e[0]||(e[0]=l=>y.value=!1),class:"ml-auto text-green-500 hover:text-green-700"},[...e[13]||(e[13]=[t("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])])])])):v("",!0),e[21]||(e[21]=t("div",{class:"bg-gradient-to-r from-red-900 to-red-700 rounded-lg shadow-lg p-6 md:p-8 text-white"},[t("div",{class:"flex items-center gap-3 mb-2"},[t("svg",{class:"w-8 h-8",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"})]),t("h1",{class:"text-2xl md:text-3xl font-bold"},"Events & Announcements Calendar")]),t("p",{class:"text-red-100"},"Manage course deadlines and announcements for your students")],-1)),t("div",he,[t("div",ke,[t("div",{class:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4 mb-6"},[t("div",{class:"flex gap-2"},[t("button",{onClick:Y,class:"flex items-center gap-2 px-4 py-2 bg-red-900 hover:bg-red-800 text-white rounded-lg font-medium transition"},[...e[15]||(e[15]=[t("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})],-1),t("span",null,"Create",-1)])])])]),U(G(ge),{options:L.value},null,8,["options"])]),t("div",Ce,[t("div",Ee,[e[20]||(e[20]=t("h2",{class:"text-xl font-bold text-gray-900 mb-4"},"Announcements",-1)),t("div",Me,[e[17]||(e[17]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Filter by Category:",-1)),g(t("select",{"onUpdate:modelValue":e[1]||(e[1]=l=>M.value=l),class:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-900 focus:border-transparent"},[e[16]||(e[16]=t("option",{value:"all"},"All Categories",-1)),(i(),n(x,null,k(w,l=>t("option",{key:l.value,value:l.value},u(l.label),9,Se)),64))],512),[[D,M.value]])]),t("div",De,[e[18]||(e[18]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Search:",-1)),g(t("input",{"onUpdate:modelValue":e[2]||(e[2]=l=>S.value=l),type:"text",placeholder:"Search events...",class:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-900 focus:border-transparent"},null,512),[[C,S.value]])]),t("div",Te,[e[19]||(e[19]=t("p",{class:"text-sm font-medium text-gray-700 mb-2"},"Color Legend:",-1)),t("div",Ve,[(i(),n(x,null,k(w,l=>t("div",{key:l.value,class:"flex items-center gap-2"},[t("div",{class:"w-4 h-4 rounded",style:j({backgroundColor:l.color})},null,4),t("span",Ae,u(l.label),1)])),64))])]),t("div",Ue,[(i(!0),n(x,null,k($.value.slice(0,10),l=>(i(),n("div",{key:l.id,class:re(["border rounded-lg p-3 hover:shadow-md transition cursor-pointer",{"border-l-4":!0}]),style:j({borderLeftColor:l.color}),onClick:b=>q({event:{id:l.id}})},[t("div",Be,[t("div",Fe,[t("div",Le,[t("h4",$e,[l.is_deadline?(i(),n("span",qe,"ðŸ“Œ")):v("",!0),ne(" "+u(l.title),1)]),l.is_deadline?(i(),n("span",ze," Deadline ")):v("",!0),l.is_own?v("",!0):(i(),n("span",Ge," Admin "))]),t("p",Oe,u(X(l.date))+" â€¢ "+u(Z(l.time)),1),l.course_name?(i(),n("p",We," ðŸ“š "+u(l.course_name),1)):v("",!0),t("p",Ne,u(l.description),1)]),t("span",{class:"px-2 py-1 text-xs rounded",style:j({backgroundColor:l.color+"20",color:l.color})},u(K(l.category)),5)])],12,je))),128)),$.value.length===0?(i(),n("div",Pe," No events found ")):v("",!0)])])])])]),_.value?(i(),n("div",{key:0,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",onClick:O(m,["self"])},[t("div",He,[t("div",Ie,[t("h3",Re,u(r.value?"Edit Event":"Create Event"),1),t("button",{onClick:m,class:"text-gray-500 hover:text-gray-700"},[...e[22]||(e[22]=[t("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])])]),t("div",Ye,[r.value&&o.value&&!o.value.is_own?(i(),n("div",Qe,[e[23]||(e[23]=t("p",{class:"text-sm text-blue-800"}," â„¹ï¸ This is an admin event. You can view details but cannot edit or delete it. ",-1)),t("p",Je,"Created by: "+u(o.value.created_by),1)])):v("",!0),t("form",{onSubmit:O(Q,["prevent"]),class:"space-y-4"},[t("div",null,[e[24]||(e[24]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Title *",-1)),g(t("input",{"onUpdate:modelValue":e[3]||(e[3]=l=>a.value.title=l),type:"text",disabled:r.value&&o.value&&!o.value.is_own,class:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-900 focus:border-transparent disabled:bg-gray-100",placeholder:"Event title",required:""},null,8,Ke),[[C,a.value.title]])]),t("div",Xe,[t("div",null,[e[25]||(e[25]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Date *",-1)),g(t("input",{"onUpdate:modelValue":e[4]||(e[4]=l=>a.value.date=l),type:"date",disabled:r.value&&o.value&&!o.value.is_own,class:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-900 focus:border-transparent disabled:bg-gray-100",required:""},null,8,Ze),[[C,a.value.date]])]),t("div",null,[e[26]||(e[26]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Time (Optional)",-1)),g(t("input",{"onUpdate:modelValue":e[5]||(e[5]=l=>a.value.time=l),type:"time",disabled:r.value&&o.value&&!o.value.is_own,class:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-900 focus:border-transparent disabled:bg-gray-100"},null,8,et),[[C,a.value.time]])])]),t("div",null,[e[27]||(e[27]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Category *",-1)),g(t("select",{"onUpdate:modelValue":e[6]||(e[6]=l=>a.value.category=l),disabled:r.value&&o.value&&!o.value.is_own,class:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-900 focus:border-transparent disabled:bg-gray-100",required:""},[(i(),n(x,null,k(w,l=>t("option",{key:l.value,value:l.value},u(l.label),9,lt)),64))],8,tt),[[D,a.value.category]])]),t("div",null,[t("label",st,[g(t("input",{"onUpdate:modelValue":e[7]||(e[7]=l=>a.value.is_deadline=l),type:"checkbox",disabled:r.value&&o.value&&!o.value.is_own,class:"w-4 h-4 text-red-900 border-gray-300 rounded focus:ring-red-900 disabled:bg-gray-100"},null,8,at),[[ie,a.value.is_deadline]]),e[28]||(e[28]=t("span",{class:"text-sm font-medium text-gray-700"},"Mark as Deadline (Quiz, Activity, etc.)",-1))])]),t("div",null,[e[30]||(e[30]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Target Audience *",-1)),g(t("select",{"onUpdate:modelValue":e[8]||(e[8]=l=>a.value.target_audience=l),disabled:r.value&&o.value&&!o.value.is_own,class:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-900 focus:border-transparent disabled:bg-gray-100",required:""},[...e[29]||(e[29]=[t("option",{value:"both"},"All Students (All Courses)",-1),t("option",{value:"students"},"Specific Course",-1)])],8,ot),[[D,a.value.target_audience]])]),a.value.target_audience==="students"?(i(),n("div",rt,[e[32]||(e[32]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Select Course *",-1)),g(t("select",{"onUpdate:modelValue":e[9]||(e[9]=l=>a.value.course_id=l),disabled:r.value&&o.value&&!o.value.is_own,class:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-900 focus:border-transparent disabled:bg-gray-100",required:""},[e[31]||(e[31]=t("option",{value:null},"Select a course...",-1)),(i(!0),n(x,null,k(B.courses,l=>(i(),n("option",{key:l.id,value:l.id},u(l.title)+" "+u(l.section?`- ${l.section}`:""),9,it))),128))],8,nt),[[D,a.value.course_id]])])):v("",!0),t("div",null,[e[33]||(e[33]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Description *",-1)),g(t("textarea",{"onUpdate:modelValue":e[10]||(e[10]=l=>a.value.description=l),disabled:r.value&&o.value&&!o.value.is_own,rows:"4",class:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-900 focus:border-transparent disabled:bg-gray-100",placeholder:"Event description",required:""},null,8,dt),[[C,a.value.description]])]),t("div",ut,[r.value&&o.value&&o.value.is_own?(i(),n("button",{key:0,type:"button",onClick:e[11]||(e[11]=l=>J(o.value.id)),disabled:d.value,class:"px-4 py-2 bg-red-600 hover:bg-red-700 text-white rounded-lg font-medium transition disabled:opacity-50"}," Delete ",8,ct)):v("",!0),t("div",vt,[t("button",{type:"button",onClick:m,disabled:d.value,class:"px-4 py-2 bg-gray-200 hover:bg-gray-300 text-gray-700 rounded-lg font-medium transition disabled:opacity-50"},u(r.value&&o.value&&!o.value.is_own?"Close":"Cancel"),9,pt),!r.value||o.value&&o.value.is_own?(i(),n("button",{key:0,type:"submit",disabled:d.value,class:"px-4 py-2 bg-red-900 hover:bg-red-800 text-white rounded-lg font-medium transition disabled:opacity-50"},u(d.value?"Saving...":r.value?"Update":"Create"),9,gt)):v("",!0)])])],32)])])])):v("",!0)]),_:1})],64))}},ht=be(mt,[["__scopeId","data-v-a3b16ffa"]]);export{ht as default};
